---
aliases:
  - 014 Transaction Annotationê³¼ ì¼ê´€ì„±(Consistency)
tags:
  - Transaction
  - DB
author: Min Jo
created: 2025-04-26
---
# Transaction Annotationê³¼ ì¼ê´€ì„±(Consistency)
---

Transactionì˜ íŠ¹ì„±ì¤‘ C(Consistency)ë¥¼ ê³µë¶€í•˜ëŠ” ë„ì¤‘ Transactional ì–´ë…¸í…Œì´ì…˜ì„ ì´ìš©í•˜ë©´ 
ë‹¨ìˆœíˆ DBì—ì„œë¿ë§Œì•„ë‹ˆë¼ ë¹„ì¦ˆë‹ˆìŠ¤ë¡œì§ê³¼ì˜ ì—°ê²°ì„ ì´ìš©í•˜ì—¬ **í•˜ë‚˜ì˜ ë©”ì†Œë“œë¥¼ íŠ¸ëœì­ì…˜ì˜ ë‹¨ìœ„**ë¡œ ë³¸ë‹¤ëŠ” ê²ƒì„ ì•Œê²Œë˜ì—ˆë‹¤.

---
### 1.@Transactional

```java
# ê°œë°œì ì…ì¥ì—ì„œ í•˜ë‚˜ì˜ ë©”ì†Œë“œë¥¼ @Transactional ì–´ë…¸í…Œì´ì…˜ì„ ì´ìš©í•˜ì—¬ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë³´ëŠ” ê²ƒì´ë‹¤.

@Transactional 
public void saveService(MyServiceDTO dto) {
		if(dto.size() < 0) {
			throw new IllegalArgumentException("ì•„ë¬´ê²ƒë„ ì¡´ì¬í•˜ì§€ ì•ŠìŒ");
		}
		
		save(dto);
	}
```

ë”ìš± ìƒì„¸í•˜ë©´ ì„¤ëª…í•˜ìë©´
- `saveService`ë¼ëŠ” ë©”ì†Œë“œëŠ” Springì˜ ì–´ë…¸í…Œì´ì…˜ì„ ì´ìš©í•˜ì—¬ íŠ¸ëœì­ì…˜ ë‹¨ìœ„ê°€ ë˜ì—ˆë‹¤.
- ì½”ë“œ ìƒì—ì„œ ì—ëŸ¬(Exception)ì´ ë°œìƒí•˜ê±°ë‚˜ 
- DBì‘ì—…(ì¿¼ë¦¬)ê°€ ì‹¤íŒ¨í•˜ë©´ íŠ¸ëœì­ì…˜ì€ `ROLLBACK` ëœë‹¤.
- ëª¨ë“  ì½”ë“œì™€ DB ì¿¼ë¦¬ê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ì—¬ì•¼ íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹(Commit) ëœë‹¤.

---

#### ğŸš¨  ì¡°ì‹¬í•  ì 

- **ëŸ°íƒ€ì„ ì˜ˆì™¸(RunTimeException)ê°€** ë°œìƒí•˜ë©´ íŠ¸ëœì­ì…˜ì€ ìë™ìœ¼ë¡œ `ROLLBACK`
- **ì²´í¬ ì˜ˆì™¸(Exception)ì€** ìë™ìœ¼ë¡œ `ROLLBACK`ë˜ì§€ ì•ŠìŒ
  â†’ í•„ìš”í•˜ë©´ `@Transactional(rollbackFor = Exception.class)` ì´ë ‡ê²Œ ì„¤ì •
- **DB ë ˆë²¨ ì—ëŸ¬**(ex. ì œì•½ì¡°ê±´ ìœ„ë°˜, Deadlock ë“±)ê°€ ë°œìƒí•˜ë©´ â†’ ì—­ì‹œ ë¡¤ë°±ë¼.


---



### 2.@Transactional ì„ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ìƒí™© 

ê·¸ë ‡ë‹¤ë©´ `@Transactional` ì„ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ìƒí™©ì€ ì–¸ì œì¼ê¹Œ ? 

ê°œë…ì ìœ¼ë¡œ ì´í•´í•œë‹¤ë©´
íŠ¸ëœì­ì…˜ì€ **"ì–´ë–¤ ì‘ì—…ì„ í•˜ë‚˜ì˜ ë…¼ë¦¬ì  ë‹¨ìœ„ë¡œ ë³´ê³ " ì„±ê³µ/ì‹¤íŒ¨ë¥¼ ì›ìì ìœ¼ë¡œ ê´€ë¦¬**í•  ë•Œ í•„ìš”.
ì‘ì—…ì„ ëª¨ë‘ ì„±ê³µì‹œí‚¤ê±°ë‚˜, ëª¨ë‘ ì·¨ì†Œì‹œì¼œì•¼ í•˜ëŠ”ê°€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì„ íƒí•œë‹¤.
-> ì´ê²ƒì„ 3ê°œ(ì“°ê¸° ì‘ì—…, ë³µì¡í•œ ì½ê¸° ì‘ì—…, íŠ¸ëœì­ì…˜ì´ í•„ìš”ì—†ëŠ” ê²½ìš°)ì˜ í° í‹€ë¡œ ì •ì˜í•˜ê³ ì í•œë‹¤.

1.ì“°ê¸° ì‘ì—…("ë³€ê²½ ì‘ì—…")ì„ í•  ë•Œ 

- insert, update, delete -> ë¬´ì¡°ê±´ íŠ¸ëœì­ì…˜ì´ í•„ìš”í•˜ë‹¤.
- í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•˜ë©´ ë°ì´í„°ì˜ ì‹ ë¢°ë„ê°€ ë–¨ì–´ì§„ë‹¤.
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë‹¨ìœ„ë¡œ íŠ¸ëœì­ì…˜ì„ ë¬¶ì–´ì•¼í•œë‹¤.


2.ë³µì¡í•œ ì½ê¸° ì‘ì—…
- í‰ë²”í•œ `select`ëŠ” íŠ¸ëœì­ì…˜ì´ í•„ìš”ì—†ë‹¤.
- ê·¸ëŸ°ë° ì—¬ëŸ¬ í…Œì´ë¸”ì„ join í•˜ê±°ë‚˜ ë„ì¤‘ì— ìƒíƒœê°€ ë³€í•  ìœ„í—˜ì´ ìˆëŠ” ê²½ìš°ëŠ” 
    ex) A í…Œì´ë¸” ì¡°íšŒ -> B í…Œì´ë¸” ì¡°íšŒ -> A í…Œì´ë¸”ì˜ ìƒíƒœê°€ ë‹¤ë¥¸ ì‘ì—…ì— ì˜í•´ì„œ ë³€í•  ìˆ˜ ìˆëŠ”ê²½ìš° 

```java
@Transactional(readOnly = true)
public List<Product> getProductsAndOrders(Long customerId) {
    List<Product> products = productRepository.findByCustomerId(customerId);
    // ì—¬ê¸°ì„œ Order ìƒíƒœë¥¼ ê°™ì´ ì¡°íšŒí•˜ê³ , ê·¸ ì‚¬ì´ì— ìƒíƒœ ë³€ë™ì´ ìˆì„ ìˆ˜ ìˆëŠ” ê²½ìš°
    return products;
}
```

ì´ëŸ¬í•œ ê²½ìš°ì—ëŠ” íŠ¹ë³„í•˜ê²Œ "ì½ê¸° ì „ìš© íŠ¸ëœì­ì…˜" ì„ ì´ìš©í•œë‹¤.

```java
@Transactional(readonly = true)
```

`readOnly = true` ì˜µì…˜ì„ ì£¼ë©´

- ì„±ëŠ¥ ìµœì í™”(DBê°€ dirty checking ê°™ì€ ê±¸ ì•ˆ í•¨ â†’ JPAë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°)
- ì½ê¸° ì‘ì—…ì´ë¼ëŠ” ê±¸ ëª…ì‹œì ìœ¼ë¡œ í‘œì‹œí•  ìˆ˜ ìˆë‹¤.

3.íŠ¸ëœì­ì…˜ì´ í•„ìš” ì—†ëŠ” ê²½ìš°
- ë‹¨ìˆœ ì¡°íšŒ 
- ë‹¨ìˆœ ê³„ì‚°(DB ê´€ë ¨ ì—†ëŠ” ê²½ìš°)
- ì™¸ë¶€ APIë§Œ í˜¸ì¶œ

---
### âœ¨ ì •ë¦¬

| ìƒí™©                   | íŠ¸ëœì­ì…˜ í•„ìš” ì—¬ë¶€           | ë¹„ê³                 |
| -------------------- | -------------------- | ----------------- |
| insert/update/delete | âœ… í•„ìš”                 | ë°ì´í„° ì†ìƒ ë°©ì§€         |
| ë‹¨ìˆœ select            | âŒ ë¶ˆí•„ìš”                | ì½ê¸° ì „ìš©             |
| ë³µì¡í•œ select + ì¼ê´€ì„± í•„ìš”  | âœ… í•„ìš” (readOnly íŠ¸ëœì­ì…˜) | join/ë™ì‹œì„± ì´ìŠˆ ìˆì„ ë•Œ  |
| ê³„ì‚°, API í˜¸ì¶œ ë“±         | âŒ ë¶ˆí•„ìš”                | DB ì‘ì—… ì—†ìœ¼ë©´ ì•ˆ ê±¸ì–´ë„ ë¨ |




---


ì½ê¸° ì‘ì—…ì— ëŒ€í•´ì„œëŠ” **DBê°€ ë” íš¨ìœ¨ì ìœ¼ë¡œ ë™ì‘**í•˜ê²Œ ë§Œë“ ë‹¤ëŠ” ì ì„ ì¶”ê°€í•  ìˆ˜ ìˆì–´. 
-> ì½ê¸°ì‘ì—…ì— ëŒ€í•´ì„œ ì–´ë–»ê²Œ ë‚´ë¶€ê°€ ëŒì•„ê°€ì„œ DBê°€  ë” íš¨ìœ¨ì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ì— ëŒ€í•´ì„œ ì„¤ëª…ì„ ë“£ê³ ì‹¶ë‹¤.
