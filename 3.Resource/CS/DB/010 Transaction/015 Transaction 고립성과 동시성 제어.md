---
aliases:
  - 015 Transition 고립성과 동시성 제어
tags:
  - DB
  - Transaction
author: Min Jo
created: 2025-05-01
---
# 015 Transaction 고립성과 동시성 제어 
-----

트랜잭션(Transaction)의 특징(ACID)중 **고립성**에 대해서 공부를 하던도중 한 가지 의문이 들었다.

Isolation(고립성) - 하나의 트랜잭션이 실행될 때 다른 트랜잭션은 참여할 수 없다.
하지만 하나의 트랜잭션이 순차적으로 진행된다면 DB의 성능은 매우 낮아질텐데 어떻게 극복할 수 있을까 ??


### 👨‍💻 동시성 제어

이를 해결하기 위한 방안이 바로 **동시성 제어**이다.
각각의 DBMS(Oracle, MariaDB, PostegreSQL)등에서 동시성 제어의 방식을 지정해두어 
성능 이슈를 해결할 수 있다.

#### 동시성 제어 방식(DBMS가 선택)

| 방식                      | 설명                                                             |
| ----------------------- | -------------------------------------------------------------- |
| **락(Lock)**             | 자원을 점유해서 다른 트랜잭션이 접근하지 못하게 함. 대표: 2단계 잠금(2PL)                  |
| **MVCC (다중 버전 동시성 제어)** | 트랜잭션마다 데이터의 스냅샷을 제공하여 락 없이도 읽기 가능 (예: PostgreSQL, Oracle 일부 등) |
| **타임스탬프 기반 제어**         | 트랜잭션 시작 시간을 기준으로 순서를 관리해 충돌 방지                                 |

#### 고립성 레벨(개발자가 선택)

| Isolation Level      | 읽기 동작         | InnoDB 내부 처리 방식                    | 발생 가능 현상               |
| -------------------- | ------------- | ---------------------------------- | ---------------------- |
| **READ UNCOMMITTED** | 변경 전 값까지 읽음   | 거의 제약 없음, MVCC로 undo 로그도 무시        | Dirty Read 발생 가능       |
| **READ COMMITTED**   | 커밋된 값만 읽음     | MVCC를 사용하여 undo 로그에서 최신 커밋만 반영     | Non-repeatable Read 가능 |
| **REPEATABLE READ**  | 트랜잭션 내에서 동일값  | MVCC로 Snapshot 고정, Phantom Read 막음 | 기본값, 성능-일관성 균형         |
| **SERIALIZABLE**     | 트랜잭션 직렬 실행 수준 | Lock을 더 많이 사용 (읽기도 공유락)            | 가장 안전하지만 느림            |
|                      |               |                                    |                        |

필자는 현재 MariaDB를 사용하여 서비스를 개발하고 있기때문에 MariaDB로 예시를 든다. 

MariaDB는 읽기와 쓰기에 다른 동시성 제어방식을 택한다.

읽기 (SELECT)
	- MVCC 사용 
	- 스냅샷(snapshop)을 기반으로 데이터를 기록한다.
	- 락을 걸지 않기 때문에 동시성이 높고, 읽기 성능이 좋습니다.
#### 쓰기 (INSERT / UPDATE / DELETE)
- **레코드 단위 Lock (Row-Level Lock)** 사용
- 충돌을 방지하기 위해 해당 레코드에 **X (Exclusive) Lock**을 걸어야 하고, 이로 인해 **대기나 충돌**, **Deadlock**이 발생할 수 있습니다.
- 쓰기가 많아질수록 성능 병목이 발생할 수 있습니다.


### ✅ 1. **MVCC 덕분에 락을 걸지 않음 (읽기 락 없음)**

조회 쿼리(SELECT)는 트랜잭션 안에서 실행되더라도,  
`MVCC`를 사용하는 InnoDB에서는 **다른 트랜잭션을 방해하지 않고**,  
**락 없이도 일관된 데이터 스냅샷을 읽을 수 있기 때문에** 성능이 매우 좋습니다.

#### 예시:

- 트랜잭션 A가 어떤 데이터를 읽고 있어도,
- 트랜잭션 B는 그 데이터를 자유롭게 수정할 수 있고,
- 둘은 서로 **서로를 기다릴 필요가 없습니다**.
  📌 즉, **읽는 동안 다른 트랜잭션을 기다리지 않기 때문에 동시성이 매우 높습니다.**

---
